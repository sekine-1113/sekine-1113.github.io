<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶…çµ¶ç¾å°‘å¥³ä¸­è°·è‚²ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
</head>
<body>
    <div class="container text-center">
        <h2>è¶…çµ¶ç¾å°‘å¥³ä¸­è°·è‚²ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿</h2>
        <div class="fs-3">
            å…¨<span id="count"></span>é€šã‚Š
        </div>
        <div>
            <button id="generate" type="button" class="btn btn-primary" disabled>
                ç”Ÿæˆã™ã‚‹
            </button>
            <button id="share" type="button" class="btn btn-dark" disabled>X ã§çµæœã‚’ã‚·ã‚§ã‚¢ã™ã‚‹</button>
        </div>

        <div class="p-2">
            <h3>ç”Ÿæˆçµæœ</h3>
            <div id="resultBox" class="fs-2">
            </div>
        </div>
    </div>

    <script>
        const pick = (arr) => arr[Math.floor(Math.random() * arr.length)];

        let data = null;
        let latestResult = "";
        const generateBtn = document.getElementById("generate");
        const shareBtn = document.getElementById("share");

        const updateCombinationCount = () => {
            if (!data) return;

            document.getElementById("count").textContent = data.prefix1.length * data.prefix2.length * data.name.length;
        }

        window.addEventListener("DOMContentLoaded", (ev) => {
            fetch("./word.json")
                .then(res => res.json())
                .then(json => {
                    data = json;
                    updateCombinationCount();
                    generateBtn.disabled = false;
                })
        });
        generateBtn.addEventListener("click", (ev) => {
            ev.preventDefault();
            const result = document.createElement("div");
            let generateResult = null;
            do {
                generateResult = `${pick(data.prefix1)}${pick(data.prefix2)}${pick(data.name)}`;
            } while (generateResult === latestResult);
            result.textContent = generateResult;
            latestResult = generateResult;
            const resultBox = document.getElementById("resultBox");
            resultBox.prepend(result);
            shareBtn.disabled = false;
        });

        shareBtn.addEventListener("click", () => {
            if (!latestResult) {
                alert("ç”ŸæˆçµæœãŒã‚ã‚Šã¾ã›ã‚“ã€‚ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚");
                return;
            }

            const text =
            `#è¶…çµ¶ç¾å°‘å¥³ä¸­è°·è‚²ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼\n` +
            `ç”Ÿæˆçµæœï¼š${latestResult}\n\n` +
            `ã¿ã‚“ãªã‚‚ç”Ÿæˆã—ã¦ã¿ã¦ğŸ‘‡\n`
            ;

            const url = location.href;

            const intentUrl =
                "https://twitter.com/intent/tweet?text=" +
                encodeURIComponent(text) +
                "&url=" +
                encodeURIComponent(url);

            window.open(intentUrl, "_blank", "noopener,noreferrer");
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
</body>
</html>
